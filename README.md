# 🌱 Android IoT — Мобильное приложение для системы автоматизации теплицы

<div align="center">
  <p><em>Дополнительный модуль управления для системы автоматизации тепличного комбината</em></p>
</div>

---

## 📋 Содержание

- [О проекте](#-о-проекте)
- [Для пользователей](#-для-пользователей)
  - [Требования](#требования)
  - [Установка](#установка)
  - [Руководство пользователя](#руководство-пользователя)
- [Для разработчиков](#-для-разработчиков)
  - [Технологии](#технологии)
  - [Структура проекта](#структура-проекта)
  - [Сборка проекта](#сборка-проекта)
  - [API взаимодействие](#api-взаимодействие)
- [Совместимость с MPU-Workplace-Automation](#-совместимость-с-mpu-workplace-automation)
- [Лицензия](#-лицензия)
- [Контакты](#-контакты)

---

## 🌿 О проекте

**Android IoT** — мобильное приложение для ОС Android, предназначенное для удаленного мониторинга и управления системой автоматизации тепличного комбината. Приложение позволяет:

- 📊 Отслеживать показатели датчиков влажности почвы в реальном времени
- 🌡️ Контролировать температуру и влажность воздуха
- 💧 Управлять системой полива
- 🪟 Управлять вентиляцией теплицы
- 📈 Визуализировать данные с помощью графиков
- 💾 Экспортировать данные в файл

---

## 👤 Для пользователей

### Требования

- Android 9.0 (API 28) или выше
- Подключение к локальной Wi-Fi сети
- Настроенная система автоматизации [MPU-Workplace-Automation](https://github.com/MishaPatsiupin/MPU-Workplace-Automation)

### Установка

1. **Загрузите APK файл** из раздела [Releases](https://github.com/MishaPatsiupin/Android-app-IoT/releases) или соберите проект самостоятельно
2. **Включите установку из неизвестных источников** в настройках Android:
   - Настройки → Безопасность → Неизвестные источники
3. **Установите приложение**, открыв загруженный APK файл
4. **Предоставьте разрешения**:
   - Доступ к интернету (для связи с устройствами)
   - Доступ к хранилищу (для экспорта данных)

### Руководство пользователя

> 📝 **Примечание:** Интерфейс приложения на белорусском языке. В документации приведены оригинальные названия элементов интерфейса с переводом на русский язык в скобках.

#### Главный экран

После запуска приложения вы увидите главный экран с информацией о проекте. Доступ к меню управления устройствами осуществляется через боковое меню (свайп слева или нажатие на иконку меню).

#### Добавление устройства

1. Откройте боковое меню
2. Нажмите кнопку **«Дадаць прыладу»** _(бел. "Добавить устройство")_
3. Заполните данные:
   - **«Назва»** — локальное имя устройства (например, "Теплица 1")
   - **«Тып»** — тип устройства (`tepliza` или `gradka`)
   - **«IP адрэс»** — IP-адрес устройства в локальной сети (например, `192.168.1.100`)
4. Нажмите **«Дадаць»** _(бел. "Добавить")_ для сохранения

#### Просмотр данных устройства

1. Нажмите на имя устройства в боковом меню
2. Откроется экран с детальной информацией:
   - **График влажности почвы** — визуализация данных с датчиков
   - **Температура и влажность воздуха**
   - **Состояние полива и вентиляции** (для типа `tepliza`)
   - **Наличие воды в баке** (для типа `tepliza`)
   - **Состояние перелива** (для типа `tepliza`)

#### Управление устройствами (тип `tepliza`)

- **Кнопка «Зм.»** _(бел. "Изменить")_ (рядом с поливом) — включить/выключить насос полива
- **Кнопка «Зм.»** (рядом с вентиляцией) — открыть/закрыть окно вентиляции

#### Удаление устройства

- **Долгое нажатие** на устройство в боковом меню → подтвердите удаление

#### Поддержка жестов

Приложение поддерживает управление жестами:
- **Жест добавления** (`ges_add`) — добавить новое устройство
- **Жест удаления** (`ges_del`) — удалить устройство по имени
- **Жест экспорта** (`ges_export`) — экспортировать данные на экране устройства

#### Экспорт данных

Данные с текущего экрана устройства можно экспортировать в текстовый файл:
1. Выполните жест экспорта на экране устройства
2. Файл сохранится в папку `Documents/home_iot/` с именем `[название_устройства]_[дата_время].txt`

---

## 👨‍💻 Для разработчиков

### Технологии

| Технология | Версия | Описание |
|------------|--------|----------|
| **Java** | 1.8 | Основной язык разработки |
| **Android SDK** | 34 (compileSdk) | Целевая версия Android |
| **Android SDK** | 28 (minSdk) | Минимальная поддерживаемая версия |
| **Gradle** | 8.x | Система сборки |
| **NDK** | 28.0.12433566 rc1 | Native Development Kit для C кода |
| **Firebase Auth** | latest | Аутентификация пользователей |
| **Volley** | latest | HTTP-клиент для REST API |
| **MPAndroidChart** | v3.1.0 | Библиотека построения графиков |
| **Gson** | latest | JSON сериализация/десериализация |

### Структура проекта

```
Android-app-IoT/
├── app/
│   ├── src/
│   │   ├── main/
│   │   │   ├── java/com/example/home/
│   │   │   │   ├── MainActivity.java          # Главная активность с боковым меню
│   │   │   │   ├── LoginActivity.java         # Экран авторизации (Firebase)
│   │   │   │   ├── DeviceDetailActivity.java  # Экран управления устройством
│   │   │   │   ├── adapter/
│   │   │   │   │   └── DeviceAdapter.java     # Адаптер списка устройств
│   │   │   │   └── ui/
│   │   │   │       ├── device/
│   │   │   │       │   └── Device.java        # Модель устройства
│   │   │   │       └── home/
│   │   │   │           ├── HomeFragment.java  # Главный фрагмент
│   │   │   │           └── HomeViewModel.java # ViewModel главного экрана
│   │   │   ├── cpp/
│   │   │   │   ├── CMakeLists.txt             # CMake конфигурация
│   │   │   │   └── moisture_data.c            # Native код сглаживания данных
│   │   │   ├── res/
│   │   │   │   ├── layout/                    # XML макеты экранов
│   │   │   │   ├── values/                    # Ресурсы (строки, цвета, темы)
│   │   │   │   ├── navigation/                # Навигационный граф
│   │   │   │   └── raw/
│   │   │   │       └── gestures               # Файл распознавания жестов
│   │   │   └── AndroidManifest.xml            # Манифест приложения
│   │   ├── androidTest/                       # Инструментальные тесты
│   │   └── test/                              # Unit тесты
│   └── build.gradle                           # Gradle конфигурация модуля
├── gradle/                                    # Gradle wrapper
├── build.gradle                               # Корневая Gradle конфигурация
├── settings.gradle                            # Настройки проекта
└── README.md                                  # Документация
```

### Сборка проекта

#### Требования для сборки

- **Android Studio** Arctic Fox (2020.3.1) или новее
- **JDK** 8 или выше
- **Android SDK** с API 34
- **Android NDK** 28.0.12433566 rc1
- **CMake** (для сборки native кода)

#### Шаги сборки

1. **Клонируйте репозиторий:**
   ```bash
   git clone https://github.com/MishaPatsiupin/Android-app-IoT.git
   cd Android-app-IoT
   ```

2. **Откройте проект в Android Studio:**
   - File → Open → выберите папку проекта

3. **Синхронизируйте Gradle:**
   - Android Studio автоматически предложит синхронизировать проект
   - Или: File → Sync Project with Gradle Files

4. **Настройте Firebase (опционально):**
   - Создайте проект в [Firebase Console](https://console.firebase.google.com/)
   - Добавьте приложение Android с package name `com.example.home`
   - Скачайте `google-services.json` и поместите в папку `app/`
   - Включите Email/Password аутентификацию в Firebase Console

5. **Соберите проект:**
   ```bash
   ./gradlew assembleDebug
   ```
   APK файл будет создан в `app/build/outputs/apk/debug/`

6. **Запустите на устройстве/эмуляторе:**
   ```bash
   ./gradlew installDebug
   ```

#### Сборка Release версии

```bash
./gradlew assembleRelease
```

> ⚠️ Для release-сборки необходимо настроить подпись приложения в `app/build.gradle`

### API взаимодействие

Приложение взаимодействует с устройствами через REST API по HTTP протоколу.

#### Эндпоинты

| Метод | Эндпоинт | Описание |
|-------|----------|----------|
| `GET` | `/{type}/data` | Получение текущих данных с датчиков |
| `GET` | `/{type}/state` | Получение состояния исполнительных устройств |
| `POST` | `/{type}/set/pomp` | Управление насосом полива |
| `POST` | `/{type}/set/ventilation` | Управление вентиляцией |

Где `{type}` — тип устройства (`tepliza` или `gradka`).

#### Пример ответа `GET /tepliza/data`

```json
{
  "this_time": "12:30:45",
  "moisture1": "45.5",
  "moisture2": "52.3",
  "temperature": "24.5",
  "humidity": "65.0",
  "liquid_sensor_water": true,
  "liquid_sensor_plant": false
}
```

#### Пример ответа `GET /tepliza/state`

```json
{
  "window_flag": true,
  "water_pomp_flag": false
}
```

#### Пример запроса `POST /tepliza/set/pomp`

```json
{
  "state": true
}
```

---

## 🔗 Совместимость с MPU-Workplace-Automation

### Описание связи

Данное Android-приложение является **дополнительным модулем управления** для системы автоматизации теплицы [MPU-Workplace-Automation](https://github.com/MishaPatsiupin/MPU-Workplace-Automation).

```
┌─────────────────────────────────────────────────────────────────┐
│                    СИСТЕМА АВТОМАТИЗАЦИИ                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌─────────────┐    Wi-Fi/HTTP    ┌─────────────────────┐     │
│   │  Android    │◄───────────────►│  ESP32              │     │
│   │  App (IoT)  │    REST API     │  (Central Device)   │     │
│   └─────────────┘                  └──────────┬──────────┘     │
│                                               │                 │
│                                          ESP-NOW               │
│                                               │                 │
│                         ┌─────────────────────┼────────────┐   │
│                         │                     │            │   │
│                         ▼                     ▼            ▼   │
│                  ┌──────────────┐     ┌──────────────┐         │
│                  │ Устройство   │     │ Устройство   │   ...   │
│                  │ полива       │     │ освещения    │         │
│                  └──────────────┘     └──────────────┘         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Архитектура системы

| Компонент | Репозиторий | Описание |
|-----------|-------------|----------|
| **Центральное устройство** | [MPU-Workplace-Automation](https://github.com/MishaPatsiupin/MPU-Workplace-Automation) | ESP32 с дисплеем, датчиками и энкодером управления |
| **Устройство полива** | [MPU-Workplace-Automation](https://github.com/MishaPatsiupin/MPU-Workplace-Automation) | ESP32 с насосом и датчиками жидкости |
| **Устройство освещения** | [MPU-Workplace-Automation](https://github.com/MishaPatsiupin/MPU-Workplace-Automation) | ESP32 с реле освещения |
| **Мобильное приложение** | Android-app-IoT (этот репозиторий) | Android-приложение для удаленного управления |

### Настройка совместной работы

#### 1. Настройка ESP32 (MPU-Workplace-Automation)

1. Соберите и загрузите прошивку [MPU-Workplace-Automation](https://github.com/MishaPatsiupin/MPU-Workplace-Automation)
2. Подключите устройство к Wi-Fi сети
3. Запомните IP-адрес устройства (отображается на дисплее или в Serial Monitor)

#### 2. Настройка Android-приложения

1. Установите приложение Android IoT
2. Подключите телефон к той же Wi-Fi сети
3. Добавьте устройство:
   - **Тип:** `tepliza` (для полной системы с поливом и вентиляцией)
   - **IP:** IP-адрес центрального устройства ESP32

### Поддерживаемые типы устройств

| Тип | Описание | Функции в приложении |
|-----|----------|---------------------|
| `tepliza` | Теплица (полная система) | Полив, вентиляция, 2 датчика влажности почвы, датчики жидкости |
| `gradka` | Грядка (упрощенная система) | 1 датчик влажности почвы, давление (только мониторинг) |

### Версии и совместимость

| Android App версия | MPU-Workplace-Automation | Примечания |
|-------------------|--------------------------|------------|
| 1.0.x | main branch | Полная совместимость |

### Требования к сети

- Мобильное устройство и ESP32 должны находиться в **одной локальной сети**
- Порт **80** (HTTP) должен быть доступен
- Рекомендуется статический IP для ESP32 или резервирование DHCP

---

## 📄 Лицензия

Этот проект распространяется под свободной лицензией для образовательных целей.

---

## 📧 Контакты

**Автор:** Пацюпін Міхаіл Сяргеевіч

- **Email:** misha.bears.minsk@gmail.com
- **GitHub:** [@MishaPatsiupin](https://github.com/MishaPatsiupin)

### Связанные проекты

- [MPU-Workplace-Automation](https://github.com/MishaPatsiupin/MPU-Workplace-Automation) — Прошивка ESP32 для системы автоматизации теплицы

---

<div align="center">
  <p><em>ПМС.250503.Пацюпін — Інтэрнэт рэчаў. Мабільнае прыкладанне для сістэмы цяплічнага камбіната</em></p>
</div>
